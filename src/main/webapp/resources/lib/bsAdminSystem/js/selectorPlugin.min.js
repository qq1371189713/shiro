function bsSelectorPlugin(e,t){this.$container=$(e),this.sourceDataArr=_.isEmpty(t)?[]:t,this.itemDataArr=[],this.currentId,this.currentIndex=0,this.filterResultArr=[],this.selectResultArr=[],this.removeIdArr=[],this.isRemoveFn=!1,this.init()}!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e:e(jQuery)}(function(e){function t(t){var r=t||window.event,o=u.call(arguments,1),c=0,h=0,d=0,g=0,f=0,p=0;if(t=e.event.fix(r),t.type="mousewheel","detail"in r&&(d=-1*r.detail),"wheelDelta"in r&&(d=r.wheelDelta),"wheelDeltaY"in r&&(d=r.wheelDeltaY),"wheelDeltaX"in r&&(h=-1*r.wheelDeltaX),"axis"in r&&r.axis===r.HORIZONTAL_AXIS&&(h=-1*d,d=0),c=0===d?h:d,"deltaY"in r&&(c=d=-1*r.deltaY),"deltaX"in r&&(h=r.deltaX,0===d&&(c=-1*h)),0!==d||0!==h){if(1===r.deltaMode){var S=e.data(this,"mousewheel-line-height");c*=S,d*=S,h*=S}else if(2===r.deltaMode){var v=e.data(this,"mousewheel-page-height");c*=v,d*=v,h*=v}if(g=Math.max(Math.abs(d),Math.abs(h)),(!n||g<n)&&(n=g,l(r,g)&&(n/=40)),l(r,g)&&(c/=40,h/=40,d/=40),c=Math[c>=1?"floor":"ceil"](c/n),h=Math[h>=1?"floor":"ceil"](h/n),d=Math[d>=1?"floor":"ceil"](d/n),a.settings.normalizeOffset&&this.getBoundingClientRect){var P=this.getBoundingClientRect();f=t.clientX-P.left,p=t.clientY-P.top}return t.deltaX=h,t.deltaY=d,t.deltaFactor=n,t.offsetX=f,t.offsetY=p,t.deltaMode=0,o.unshift(t,c,h,d),s&&clearTimeout(s),s=setTimeout(i,200),(e.event.dispatch||e.event.handle).apply(this,o)}}function i(){n=null}function l(e,t){return a.settings.adjustOldDeltas&&"mousewheel"===e.type&&t%120==0}var s,n,r=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],o="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],u=Array.prototype.slice;if(e.event.fixHooks)for(var c=r.length;c;)e.event.fixHooks[r[--c]]=e.event.mouseHooks;var a=e.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var i=o.length;i;)this.addEventListener(o[--i],t,!1);else this.onmousewheel=t;e.data(this,"mousewheel-line-height",a.getLineHeight(this)),e.data(this,"mousewheel-page-height",a.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var i=o.length;i;)this.removeEventListener(o[--i],t,!1);else this.onmousewheel=null;e.removeData(this,"mousewheel-line-height"),e.removeData(this,"mousewheel-page-height")},getLineHeight:function(t){var i=e(t),l=i["offsetParent"in e.fn?"offsetParent":"parent"]();return l.length||(l=e("body")),parseInt(l.css("fontSize"),10)||parseInt(i.css("fontSize"),10)||16},getPageHeight:function(t){return e(t).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})}),bsSelectorPlugin.prototype.init=function(){this.build(),this.initEvent(),this.renderData(),this.getItemData()},bsSelectorPlugin.prototype.build=function(){this.$selectorPlugin=$('<div class="broadsense-selectorPlugin"></div>'),this.$bsSelectorPluginResultCont=$('<div class="bsSelectorPlugin-result-cont clearfix"></div>'),this.$bsSelectorPluginResult=$('<div class="bsSelectorPlugin-result clearfix"></div>'),this.$bsSelectorPluginInput=$('<input class="bsSelectorPlugin-input" type="text" placeholder="请输入关键字选择车辆">'),this.$bsSelectorPluginSelectBtn=$('<i class="bsSelectorPlugin-select-btn"></i>'),this.$bsSelectorPluginInputList=$('<div class="bsSelectorPlugin-input-list"></div>'),this.$bsSelectorPluginInputListUl=$("<ul></ul>"),this.$bsSelectorPluginSelectList=$('<div class="bsSelectorPlugin-select-list"></div>'),this.$bsSelectorPluginTree=$('<ul id="bsSelectorPluginTree" class="ztree"></ul>'),this.$bsSelectorPluginResultCont.append(this.$bsSelectorPluginResult),this.$bsSelectorPluginResult.append(this.$bsSelectorPluginInput),this.$bsSelectorPluginInputList.append(this.$bsSelectorPluginInputListUl),this.$bsSelectorPluginSelectList.append(this.$bsSelectorPluginTree),this.$selectorPlugin.append(this.$bsSelectorPluginResultCont).append(this.$bsSelectorPluginSelectBtn).append(this.$bsSelectorPluginInputList).append(this.$bsSelectorPluginSelectList),this.$container.append(this.$selectorPlugin)},bsSelectorPlugin.prototype.initEvent=function(){var e=this;$(e.$selectorPlugin).on("click",function(t){t.stopPropagation(),e.isRemoveFn=!0;var i=t.target,l=e.$bsSelectorPluginResult[0]===i,s=$.contains(e.$bsSelectorPluginResult[0],i),n=e.$bsSelectorPluginSelectBtn[0]===i,r=e.$bsSelectorPluginSelectList[0]===i,o=$.contains(e.$bsSelectorPluginSelectList[0],i);l||s||n||r||o||e.$bsSelectorPluginInput.focus()});var t,i=!1;$(e.$bsSelectorPluginInput).on("keyup",function(l){var s=$(this).val().trim(),n=l.keyCode;""===s?(t=setTimeout(function(){i=!0},1500),e.renderFilterResult(void 0)):(clearTimeout(t),i=!1),""===s&&8===n&&i?e.remove():(_.isEmpty(e.filterResultArr)||13!==n||""===s||e.confirmSelectResult(),_.isEmpty(e.filterResultArr)||38!==n||e.selectFilterResult(e.currentIndex-1),_.isEmpty(e.filterResultArr)||40!==n||e.selectFilterResult(e.currentIndex+1))}),$(e.$bsSelectorPluginInput).on("input",function(t){var i=$(this).val().trim();""!==i?(e.currentIndex=0,e.filterData(i)):/\s+/.test($(this).val())&&$(this).val("")}),$(e.$bsSelectorPluginSelectBtn).on("click",function(t){t.stopPropagation(),e.$bsSelectorPluginSelectList.toggleClass("show"),e.$bsSelectorPluginSelectBtn.toggleClass("show")}),$(e.$selectorPlugin).on("mouseover",".bsSelectorPlugin-input-list li",function(){var t=$(this).index();e.selectFilterResult(t)}),$(e.$selectorPlugin).on("click",".bsSelectorPlugin-input-list li",function(t){t.stopPropagation(),e.confirmSelectResult()}),$(e.$selectorPlugin).on("click",".bsSelectorPlugin-option",function(t){t.stopPropagation(),e.isRemoveFn=!0;var i=$(this).data("infoid");t.ctrlKey?$(this).hasClass("cur")?($(this).removeClass("cur"),_.pull(e.removeIdArr,i)):($(this).addClass("cur"),e.removeIdArr.push(i)):($(this).addClass("cur").siblings().removeClass("cur"),e.removeIdArr=[i])}),$(e.$selectorPlugin).on("click",".del",function(t){t.stopPropagation();var i=$(this).parent().data("infoid");e.removeIdArr=[i],e.remove(e.removeIdArr)}),$(document).on("click",function(t){$.contains(e.$selectorPlugin[0],t.target)||(e.$bsSelectorPluginInputList.removeClass("show"),e.$bsSelectorPluginSelectList.removeClass("show"),e.$bsSelectorPluginSelectBtn.removeClass("show"),e.$bsSelectorPluginResult.find(".bsSelectorPlugin-option").removeClass("cur"),e.removeIdArr=[],e.isRemoveFn=!1)}),$(document).on("keyup",function(t){var i=t.keyCode;8!==i||!e.isRemoveFn||_.isEmpty(e.removeIdArr)?27===i&&e.$bsSelectorPluginInputList.removeClass("show"):e.remove(e.removeIdArr)}),$(e.$bsSelectorPluginResultCont).mousewheel(function(t,i,l,s){e.$bsSelectorPluginResultCont.width(),e.$bsSelectorPluginResultCont[0].scrollWidth;var n=e.$bsSelectorPluginResultCont.scrollLeft(),r=0;-1===i?r=n+20:1===i&&(r=n-20),e.$bsSelectorPluginResultCont.scrollLeft(r)})},bsSelectorPlugin.prototype.renderData=function(){var e=this,t={data:{key:{name:"info"}},view:{showLine:!1,showIcon:!1},check:{enable:!0},callback:{onClick:function(t,i,l){if(l.isParent&&e.zTreeObj.expandNode(l,!l.open,!0,!0),console.log(l),!l.isParent){if(l.checked)e.zTreeObj.checkNode(l,!1,!0,!1),_.remove(e.selectResultArr,function(e){return e.id===l.id});else{e.zTreeObj.checkNode(l,!0,!0,!1);var s=_.filter(e.itemDataArr,function(e){return e.id===l.id});e.selectResultArr=_.concat(e.selectResultArr,s)}e.renderSelectResult()}},onCheck:function(){var t=l.getCheckedNodes(!0),i=[];_.isEmpty(t)?e.selectResultArr=[]:(_.each(t,function(t){if(!t.isParent&&!_.has(t,"children")){var l=_.find(e.itemDataArr,function(e){return e.id===t.id});i=_.concat(i,l)}}),e.selectResultArr=i),e.renderSelectResult()}}},i=e.sourceDataArr,l=$.fn.zTree.init(this.$bsSelectorPluginTree,t,i);this.zTreeObj=l},bsSelectorPlugin.prototype.getItemData=function(e){var t=this;_.each(t.sourceDataArr,function(e){t.itemDataArr=_.concat(t.itemDataArr,e.children)})},bsSelectorPlugin.prototype.filterData=function(e){_.keys(this.itemDataArr[0]);var t=[];_.each(this.itemDataArr,function(i){var l=_.filter(i,function(t){return _.includes(t,e)});_.isEmpty(l)||(t=_.concat(t,i))}),_.isEmpty(this.selectResultArr)||(t=_.differenceWith(t,this.selectResultArr,_.isEqual)),this.filterResultArr=t,this.renderFilterResult(t)},bsSelectorPlugin.prototype.renderFilterResult=function(e){if(this.$bsSelectorPluginInputListUl.empty(),e&&!_.isEmpty(e)){var t="";_.each(e,function(e){t+='<li data-infoid="'+e.id+'"><b class="info">'+e.info+"</b></li>"});var i=$(t);i.eq(0).addClass("cur");var l=this.$bsSelectorPluginInput.position(),s=l.top,n=l.left;this.$bsSelectorPluginInputListUl.append(i),this.$bsSelectorPluginInputList.css({left:s-30,left:n-8}),this.$bsSelectorPluginInputList.addClass("show"),this.selectFilterResult(this.currentIndex)}else this.$bsSelectorPluginInputList.removeClass("show")},bsSelectorPlugin.prototype.selectFilterResult=function(e){if(!_.isEmpty(this.filterResultArr)){var t=this.filterResultArr.length;e>t-1?e=0:e<0&&(e=t-1),this.currentIndex=e;var i=this.$bsSelectorPluginInputListUl.find("li").eq(e);i.addClass("cur").siblings().removeClass("cur"),this.currentId=i.data("infoid")}},bsSelectorPlugin.prototype.confirmSelectResult=function(){var e=this;e.$bsSelectorPluginInput.focus();var t=_.filter(e.itemDataArr,function(t){return t.id===e.currentId});e.selectResultArr=_.concat(e.selectResultArr,t),this.renderSelectResult()},bsSelectorPlugin.prototype.renderSelectResult=function(e){var t=this,i="";t.$bsSelectorPluginResult.find(".bsSelectorPlugin-option").remove(),t.$bsSelectorPluginInputList.removeClass("show"),t.$bsSelectorPluginInput.val(""),_.each(t.selectResultArr,function(e){var t="";e.driverName?t=e.driverName:e.carLicense?t=e.carLicense:e.imei&&(t=e.imei),i+='<div data-infoid="'+e.id+'" class="bsSelectorPlugin-option"><b class="info">'+t+'</b><i class="del"></i></div>'});$(i).insertBefore(t.$bsSelectorPluginInput);var l=t.$bsSelectorPluginResult.children(),s=0;_.each(l,function(e){s+=$(e).outerWidth(!0)}),t.$bsSelectorPluginResult.css("width",s+1);var n=t.$bsSelectorPluginResultCont.width(),r=t.$bsSelectorPluginResultCont[0].scrollWidth;r>n&&t.$bsSelectorPluginResultCont.scrollLeft(r-n),t.zTreeObj.checkAllNodes(!1),_.each(t.selectResultArr,function(e){var i=t.zTreeObj.getNodesByParam("id",e.id);_.each(i,function(e){e.isParent||t.zTreeObj.checkNode(e,!0,!0,!1)})})},bsSelectorPlugin.prototype.remove=function(e){var t=this;void 0===e&&(t.selectResultArr=_.dropRight(t.selectResultArr)),_.isEmpty(e)||_.each(e,function(e){_.remove(t.selectResultArr,function(t){return t.id===e})}),this.renderSelectResult()},bsSelectorPlugin.prototype.getInfo=function(){return this.selectResultArr},bsSelectorPlugin.prototype.reset=function(){this.selectResultArr=[],this.renderSelectResult()},bsSelectorPlugin.prototype.setDefaultData=function(e){this.selectResultArr=e,this.renderSelectResult()};